@{
    ViewData["Title"] = "Đăng Nhập";
    Layout = null;
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng Nhập - DaNang SafeMap</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --green:     #2D6A4F;
            --green-d:   #1B4332;
            --green-h:   #245c44;
            --left-bg:   #E2EDE5;
            --warm-bg:   #F9F8F3;   /* đậm hơn */
            --blob1:     #B7D9BC;
            --blob2:     #F4A261;
            --blob3:     #90CAF9;
            --text:      #1C2B1E;
            --muted:     #5C6B5E;
            --border:    #D4DDD6;
            --inp-bg:    #F2F5F2;
        }

        html, body { height: 100%; overflow: hidden; }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            display: flex;
            height: 100vh;
            background: var(--warm-bg);
            color: var(--text);
        }

        /* ══ LEFT 50% ══ */
        .left {
            width: 50%;
            background: var(--left-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 56px 52px;
            position: relative;
            overflow: hidden;
        }

        /* Blobs */
        .blob { position: absolute; border-radius: 50%; pointer-events: none; }
        .b1 { width: 280px; height: 280px; background: var(--blob1); top: -100px; left: -100px; opacity: .55; }
        .b2 { width: 150px; height: 150px; background: var(--blob2); top: 50px; right: 20px; opacity: .30; }
        .b3 { width: 220px; height: 220px; background: var(--blob1); bottom: -60px; left: -30px; opacity: .45; }
        .b4 { width: 120px; height: 120px; background: var(--blob3); bottom: 40px; right: -30px; opacity: .28; }



        .left-inner { position: relative; z-index: 1; width: 100%; max-width: 360px; }

        .logo-box {
            width: 72px; height: 72px;
            background: var(--green);
            border-radius: 22px;
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 28px;
            box-shadow: 0 12px 32px rgba(45,106,79,.32);
        }
        .logo-box svg { width: 36px; height: 36px; stroke: #fff; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

        .brand-h { font-size: 27px; font-weight: 700; line-height: 1.3; margin-bottom: 10px; }
        .brand-h span { color: var(--green); }
        .brand-p { font-size: 13.5px; color: var(--muted); line-height: 1.7; margin-bottom: 32px; }

        .features { display: flex; flex-direction: column; gap: 12px; }
        .feat {
            display: flex; align-items: center; gap: 14px;
            background: rgba(255,255,255,.80);
            border-radius: 14px;
            padding: 13px 16px;
            border: 1px solid rgba(255,255,255,.95);
            backdrop-filter: blur(8px);
            transition: transform .22s, box-shadow .22s;
            cursor: default;
        }
        .feat:hover { transform: translateX(6px); box-shadow: 0 5px 18px rgba(0,0,0,.08); }

        .feat-icon {
            width: 42px; height: 42px; flex-shrink: 0;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
        }
        .feat-icon.green  { background: #E8F5E9; }
        .feat-icon.blue   { background: #E3F2FD; }
        .feat-icon.orange { background: #FFF3E0; }
        .feat-icon svg { width: 21px; height: 21px; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .feat-icon.green  svg { stroke: #2E7D32; }
        .feat-icon.blue   svg { stroke: #1565C0; }
        .feat-icon.orange svg { stroke: #E65100; }

        .feat-text h4 { font-size: 13.5px; font-weight: 600; }
        .feat-text p  { font-size: 12px; color: var(--muted); margin-top: 2px; }

        /* ══ RIGHT 50% ══ */
        .right {
            width: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 36px;
            background: var(--warm-bg);
        }

        /* Floating card */
        .card {
            width: 100%;
            max-width: 400px;
            background: #fff;
            border-radius: 26px;
            padding: 40px 36px;
            box-shadow: 0 10px 48px rgba(0,0,0,.13), 0 2px 8px rgba(0,0,0,.06);
        }

        .card-title { font-size: 26px; font-weight: 700; text-align: center; margin-bottom: 6px; }
        .card-sub   { font-size: 13.5px; color: var(--muted); text-align: center; margin-bottom: 28px; }

        /* Error */
        .err-box {
            display: none; align-items: center; gap: 8px;
            background: #FEF2F2; border: 1px solid #FECACA;
            border-radius: 10px; padding: 10px 14px;
            font-size: 13px; color: #DC2626; margin-bottom: 16px;
        }
        .err-box svg { width: 15px; height: 15px; flex-shrink: 0; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

        /* Fields */
        .field { margin-bottom: 16px; }
        .field label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 6px; }

        .inp-wrap {
            display: flex; align-items: center;
            border: 1.5px solid var(--border);
            border-radius: 12px;
            background: var(--inp-bg);
            transition: border-color .2s, box-shadow .2s, background .2s;
        }
        .inp-wrap:focus-within {
            border-color: var(--green);
            box-shadow: 0 0 0 3px rgba(45,106,79,.13);
            background: #fff;
        }
        .inp-ico { padding: 0 13px; display: flex; align-items: center; }
        .inp-ico svg { width: 16px; height: 16px; stroke: #8FA892; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .inp-wrap input {
            flex: 1; border: none; background: transparent;
            padding: 12px 12px 12px 0;
            font-size: 14px; font-family: inherit; color: var(--text); outline: none;
        }
        .inp-wrap input::placeholder { color: #A8B8AA; }
        .eye-btn {
            padding: 0 13px; cursor: pointer; background: none; border: none;
            display: flex; align-items: center; color: #8FA892; transition: color .2s;
        }
        .eye-btn:hover { color: var(--green); }
        .eye-btn svg { width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

        /* Row mid */
        .row-mid { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .chk-label { display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--muted); cursor: pointer; }
        .chk-label input { width: 15px; height: 15px; accent-color: var(--green); cursor: pointer; }
        .forgot { font-size: 13px; font-weight: 600; color: var(--green); text-decoration: none; transition: color .2s; }
        .forgot:hover { color: var(--green-d); }

        /* Main button */
        .btn-main {
            width: 100%; padding: 13px;
            background: linear-gradient(135deg, var(--green) 0%, #1B5E3B 100%);
            color: #fff;
            border: none; border-radius: 12px;
            font-size: 15px; font-weight: 700; font-family: inherit;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: opacity .2s, transform .15s, box-shadow .2s;
            box-shadow: 0 5px 20px rgba(45,106,79,.38);
            letter-spacing: .2px;
        }
        .btn-main:hover { opacity: .92; box-shadow: 0 8px 26px rgba(45,106,79,.44); transform: translateY(-1px); }
        .btn-main:active { transform: translateY(0); }
        .btn-main:disabled { opacity: .65; cursor: not-allowed; transform: none; }
        .btn-main svg { width: 17px; height: 17px; }

        /* Divider */
        .divider { display: flex; align-items: center; gap: 12px; margin: 20px 0; font-size: 12.5px; color: #A8B8AA; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

        /* Google button */
        .btn-google {
            width: 100%; padding: 12px;
            border: 1.5px solid var(--border); border-radius: 12px; background: #fff;
            font-size: 14px; font-weight: 600; font-family: inherit;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            color: var(--text); transition: border-color .2s, background .2s, box-shadow .2s;
            margin-bottom: 22px;
        }
        .btn-google:hover { border-color: #B8C8BA; background: var(--inp-bg); box-shadow: 0 3px 10px rgba(0,0,0,.07); }
        .btn-google img { width: 19px; height: 19px; }

        /* Footer */
        .bottom-link { text-align: center; font-size: 13.5px; color: var(--muted); }
        .bottom-link a { color: var(--green); font-weight: 700; text-decoration: none; transition: color .2s; }
        .bottom-link a:hover { color: var(--green-d); }

        @@media (max-width: 820px) {
            html, body { overflow: auto; }
            .left { display: none; }
            .right { width: 100%; padding: 32px 20px; }
        }
        @@keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<!-- LEFT 50% -->
<div class="left">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="blob b4"></div>


    <div class="left-inner">
        <div class="logo-box">
            <svg viewBox="0 0 24 24">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                <polyline points="9 12 11 14 15 10"/>
            </svg>
        </div>
        <h1 class="brand-h">Chào mừng đến với<br><span>DaNang SafeMap</span></h1>
        <p class="brand-p">Hệ thống bản đồ số cảnh báo an ninh đô thị và hỗ trợ tìm người thất lạc tại thành phố Đà Nẵng.</p>
        <div class="features">
            <div class="feat">
                <div class="feat-icon green">
                    <svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                </div>
                <div class="feat-text"><h4>Bản đồ thời gian thực</h4><p>Theo dõi cảnh báo an ninh</p></div>
            </div>
            <div class="feat">
                <div class="feat-icon blue">
                    <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                </div>
                <div class="feat-text"><h4>Tìm người thất lạc</h4><p>Hỗ trợ cộng đồng tìm kiếm</p></div>
            </div>
            <div class="feat">
                <div class="feat-icon orange">
                    <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                </div>
                <div class="feat-text"><h4>Thông báo tức thì</h4><p>Cập nhật an ninh nhanh chóng</p></div>
            </div>
        </div>
    </div>
</div>

<!-- RIGHT 50% -->
<div class="right">
    <div class="card">
        <h2 class="card-title">Đăng Nhập</h2>
        <p class="card-sub">Chào mừng bạn quay lại!</p>

        <div class="err-box" id="errBox">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            <span id="errText"></span>
        </div>

        <form id="loginForm" novalidate>
            <div class="field">
                <label for="email">Email</label>
                <div class="inp-wrap">
                    <span class="inp-ico">
                        <svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                    </span>
                    <input type="email" id="email" placeholder="email@example.com" autocomplete="email" required />
                </div>
            </div>

            <div class="field">
                <label for="password">Mật khẩu</label>
                <div class="inp-wrap">
                    <span class="inp-ico">
                        <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                    </span>
                    <input type="password" id="password" placeholder="••••••••" autocomplete="current-password" required />
                    <button type="button" class="eye-btn" id="eyeBtn" aria-label="Hiện/ẩn mật khẩu">
                        <svg id="eyeIco" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                </div>
            </div>

            <div class="row-mid">
                <label class="chk-label">
                    <input type="checkbox" id="remember" /> Ghi nhớ đăng nhập
                </label>
                <a href="#" class="forgot">Quên mật khẩu?</a>
            </div>

            <button type="submit" class="btn-main" id="loginBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                    <polyline points="10 17 15 12 10 7"/>
                    <line x1="15" y1="12" x2="3" y2="12"/>
                </svg>
                Đăng Nhập
            </button>
        </form>

        <div class="divider">hoặc</div>

        <button class="btn-google" id="googleBtn" type="button">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" />
            Đăng nhập với Google
        </button>

        <p class="bottom-link">Chưa có tài khoản? <a href="/Auth/Register">Đăng ký ngay</a></p>
    </div>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<div id="g_id_onload"
     data-client_id=""
     data-callback="handleGoogle"
     data-auto_prompt="false">
</div>

<script>
document.getElementById('eyeBtn').addEventListener('click', () => {
    const inp = document.getElementById('password');
    const show = inp.type === 'password';
    inp.type = show ? 'text' : 'password';
    document.getElementById('eyeIco').innerHTML = show
        ? '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>'
        : '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
});

function showErr(msg) { document.getElementById('errText').textContent = msg; document.getElementById('errBox').style.display = 'flex'; }
function hideErr() { document.getElementById('errBox').style.display = 'none'; }

document.getElementById('loginForm').addEventListener('submit', async e => {
    e.preventDefault(); hideErr();
    const btn = document.getElementById('loginBtn');
    btn.disabled = true;
    btn.innerHTML = '<svg style="animation:spin 1s linear infinite;stroke:white;fill:none;stroke-width:2" viewBox="0 0 24 24"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Đang đăng nhập...';
    try {
        const res  = await fetch('/api/account/login', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: document.getElementById('email').value, password: document.getElementById('password').value, rememberMe: document.getElementById('remember').checked })
        });
        const data = await res.json();
        if (data.success) { 
            localStorage.setItem('token', data.token); 
            localStorage.setItem('user', JSON.stringify(data.user)); 
            document.cookie = "jwtToken=" + data.token + "; path=/; max-age=86400";
            if (data.user && data.user.role === 'Admin') {
                window.location.href = '/Admin/Dashboard';
            } else {
                window.location.href = '/'; 
            }
        }
        else showErr(data.message || 'Đăng nhập thất bại');
    } catch { showErr('Không thể kết nối đến máy chủ'); }
    finally {
        btn.disabled = false;
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg> Đăng Nhập';
    }
});

document.getElementById('googleBtn').addEventListener('click', () => google.accounts.id.prompt());
async function handleGoogle(response) {
    try {
        const res  = await fetch('/api/account/google-login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ idToken: response.credential }) });
        const data = await res.json();
        if (data.success) { 
            localStorage.setItem('token', data.token); 
            localStorage.setItem('user', JSON.stringify(data.user)); 
            document.cookie = "jwtToken=" + data.token + "; path=/; max-age=86400";
            if (data.user && data.user.role === 'Admin') {
                window.location.href = '/Admin/Dashboard';
            } else {
                window.location.href = '/'; 
            }
        }
        else showErr(data.message || 'Đăng nhập Google thất bại');
    } catch { showErr('Không thể kết nối đến máy chủ'); }
}
</script>
</body>
</html>